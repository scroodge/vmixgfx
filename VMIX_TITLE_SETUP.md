# Настройка vMix Title для работы с JSON данными

## Обзор

Это руководство объясняет, как настроить vMix Title (GTZIP файл) для автоматического получения данных из JSON endpoint и отображения их в полях Title.

## Шаг 1: Настройка Data Source в vMix

### 1.1 Открыть Data Sources Manager

1. В vMix нажмите на кнопку меню (три горизонтальные линии) в правом нижнем углу главного окна
2. Выберите **"Data Sources Manager"** из выпадающего меню

### 1.2 Добавить JSON Data Source

1. В Data Sources Manager нажмите кнопку **"+"** (плюс) для добавления нового источника данных
2. Выберите **"JSON"** из списка доступных типов источников данных
3. В настройках введите URL вашего JSON endpoint:
   ```
   http://localhost:8000/api/match/1/data.json
   ```
   Или для доступа по сети:
   ```
   http://192.168.1.100:8000/api/match/1/data.json
   ```
   (замените `192.168.1.100` на IP адрес вашего сервера)

4. Нажмите **"OK"** для сохранения источника данных

### 1.3 Настройка обновления данных

- vMix автоматически обновляет данные из JSON endpoint
- Интервал обновления можно настроить в настройках Data Source
- Рекомендуется установить интервал обновления 1-2 секунды для реального времени

## Шаг 2: Связывание полей в GTZIP Title

### 2.1 Открыть Title Editor

1. В vMix найдите ваш Title input
2. Правой кнопкой мыши на Title input → выберите **"Title Editor"**

### 2.2 Связать поля с данными

vMix автоматически обрабатывает массив объектов и использует первый объект из массива (или выбранный индекс).

Для каждого поля в Title:

1. Выберите текстовое поле, которое хотите связать (например, "Фамилия 1.Text")
2. В панели свойств найдите поле **"Data Source"** или **"Variable"**
3. Введите имя переменной из JSON в формате: `{variable_name}`

**Примечание:** Поскольку JSON возвращается как массив `[{...}]`, vMix автоматически извлекает данные из первого объекта массива. Если в массиве несколько объектов, можно указать индекс (например, `[0].home_name`), но для одного матча это не требуется.

### 2.3 Соответствие полей JSON и GTZIP

| Поле в GTZIP | Переменная JSON | Описание |
|--------------|----------------|----------|
| **Фамилия 1.Text** | `{home_name}` | Имя первого игрока (домашняя команда) |
| **Шары 1.Text** | `{balls_home}` | Шары первого игрока (текущая игра) |
| **Фамилия 2.Text** | `{away_name}` | Имя второго игрока (гостевая команда) |
| **Шары 2.Text** | `{balls_away}` | Шары второго игрока (текущая игра) |
| - | `{score_home}` | Счет партий первого игрока (выигранные партии) |
| - | `{score_away}` | Счет партий второго игрока (выигранные партии) |
| - | `{period}` | Номер текущей партии (число) |
| - | `{period_formatted}` | Номер текущей партии в скобках, например "(2)" |
| - | `{timer_formatted}` | Таймер в формате MM:SS или HH:MM:SS |
| - | `{timer_seconds}` | Таймер в секундах |
| - | `{timer_running}` | Статус таймера (true/false) |

**Примечание:** Для обратной совместимости также доступны старые названия:
- `{home_score}` = `{balls_home}` (шары домашней команды)
- `{away_score}` = `{balls_away}` (шары гостевой команды)
- `{home_match_score}` = `{score_home}` (счет партий домашней команды)
- `{away_match_score}` = `{score_away}` (счет партий гостевой команды)

## Шаг 3: Пример настройки полей

### В Title Editor для каждого поля:

**Поле "Фамилия 1.Text":**
```
{home_name}
```

**Поле "Шары 1.Text":**
```
{balls_home}
```

**Поле "Фамилия 2.Text":**
```
{away_name}
```

**Поле "Шары 2.Text":**
```
{balls_away}
```

**Дополнительные поля (если нужны):**

Для отображения счета партий:
```
{score_home} - {score_away}
```

Для отображения номера партии:
```
Партия {period}
```

### Альтернативный способ (через Data Source кнопку):

1. Выберите поле в Title Editor
2. Нажмите кнопку **"Data Source"** в панели инструментов
3. В настройках Data Source:
   - Выберите созданный JSON data source
   - Выберите таблицу/массив (обычно это будет первая строка массива)
   - Выберите колонку/поле из JSON (например, `home_name`, `home_score`)
   - Нажмите **"OK"**

**Примечание:** При использовании Data Source кнопки, vMix покажет массив как таблицу, где каждая строка - это объект из массива. Для одного матча выберите первую строку (индекс 0).

## Шаг 4: Форматирование данных (опционально)

Если нужно добавить текст или форматирование:

**Пример для счета:**
```
Шары: {home_score}
```

**Пример для таймера:**
```
Время: {timer_formatted}
```

**Пример для периода:**
```
Игра {period_formatted}
```
или просто:
```
{period_formatted}
```

## Структура JSON данных

Ваш endpoint возвращает массив объектов (vMix требует именно такой формат):

```json
[
  {
    "match_id": "1",
    "home_name": "Иванов",
    "away_name": "Петров",
    "balls_home": 8,
    "balls_away": 5,
    "score_home": 2,
    "score_away": 1,
    "period": 2,
    "period_formatted": "(2)",
    "timer_seconds": 1200,
    "timer_running": false,
    "timer_formatted": "20:00",
    "timestamp": 1703123456789,
    "rev": 42,
    "home_score": 8,
    "away_score": 5,
    "home_match_score": 2,
    "away_match_score": 1
  }
]
```

**Структура полей:**
- `balls_home` / `balls_away` - шары (текущий счет в игре)
- `score_home` / `score_away` - счет партий (количество выигранных партий)
- `period` - номер текущей партии
- Старые названия (`home_score`, `away_score`, `home_match_score`, `away_match_score`) сохранены для обратной совместимости

**Важно:** vMix требует, чтобы JSON был массивом объектов. Endpoint автоматически возвращает данные в правильном формате.

## Решение проблем

### Данные не обновляются

1. Проверьте, что сервер запущен и доступен
2. Проверьте URL в Data Source (должен быть доступен из браузера)
3. Проверьте формат JSON (должен быть валидным JSON)
4. Убедитесь, что интервал обновления настроен правильно

### Переменные не отображаются

1. Убедитесь, что используете правильный синтаксис: `{variable_name}` (с фигурными скобками)
2. Проверьте, что имена переменных точно соответствуют полям в JSON (с учетом регистра)
3. Убедитесь, что Data Source правильно настроен и активен

### Ошибка подключения

1. Проверьте, что сервер работает: откройте `http://localhost:8000/api/match/1/data.json` в браузере
2. Если используете сетевой доступ, проверьте IP адрес и порт
3. Убедитесь, что файрвол не блокирует подключение

## Дополнительные возможности

### Использование нескольких матчей

Если у вас несколько матчей, используйте разные match_id:

- Матч 1: `http://localhost:8000/api/match/1/data.json`
- Матч 2: `http://localhost:8000/api/match/2/data.json`

### Получение всех матчей

Используйте endpoint для получения всех матчей:
```
http://localhost:8000/api/matches/data.json
```

Это вернет объект со всеми активными матчами, где ключ - это match_id.

## Пример полной настройки

1. **Создайте Data Source:**
   - Тип: JSON
   - URL: `http://localhost:8000/api/match/1/data.json`
   - Интервал обновления: 1 секунда

2. **В Title Editor настройте поля:**
   - "Фамилия 1.Text" → `{home_name}`
   - "Шары 1.Text" → `{home_score}`
   - "Фамилия 2.Text" → `{away_name}`
   - "Шары 2.Text" → `{away_score}`

3. **Сохраните Title** и данные будут автоматически обновляться при изменении счета через Control Panel.

---

**Примечание:** Убедитесь, что сервер vMix Score Control запущен перед настройкой Data Source в vMix.
